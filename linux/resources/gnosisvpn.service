[Unit]
Description=Gnosis VPN Service
Documentation=https://gnosisvpn.com
After=network-online.target
Wants=network-online.target
StartLimitIntervalSec=200
StartLimitBurst=5

[Service]
Type=simple
User=root
Group=root

# Environment and configuration
EnvironmentFile=/etc/gnosisvpn/gnosisvpn.env
WorkingDirectory=/var/lib/gnosisvpn

# Main service command
ExecStart=/usr/bin/gnosis_vpn-root --hopr-blokli-url https://blokli.staging.hoprnet.link

# Restart configuration
Restart=always
RestartSec=5s

# Process management
KillMode=mixed
KillSignal=SIGTERM
TimeoutStopSec=90
TimeoutStartSec=60

# Logging
StandardOutput=append:/var/log/gnosisvpn/gnosisvpn.log
StandardError=append:/var/log/gnosisvpn/gnosisvpn.log
SyslogIdentifier=gnosisvpn

# Security hardening for VPN service
# VPN needs CAP_NET_ADMIN for tunnel management
# CAP_SETUID/CAP_SETGID needed to spawn worker as 'gnosisvpn' user
CapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_BIND_SERVICE CAP_NET_RAW CAP_SETUID CAP_SETGID
AmbientCapabilities=CAP_NET_ADMIN CAP_NET_BIND_SERVICE CAP_NET_RAW CAP_SETUID CAP_SETGID

# File system protection
ProtectSystem=strict
ProtectHome=yes
ReadWritePaths=/var/lib/gnosisvpn /var/log/gnosisvpn /var/run/gnosis_vpn

# Resource limits
LimitNOFILE=65536
LimitNPROC=512

[Install]
WantedBy=multi-user.target
